server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  # Backend application logs
  - job_name: omnify_backend
    static_configs:
      - targets:
          - localhost
        labels:
          job: omnify_backend
          service: api
          environment: ${ENVIRONMENT:-development}
          __path__: /var/log/omnify/backend/*.log
    pipeline_stages:
      - json:
          expressions:
            timestamp: timestamp
            level: level
            message: message
            request_id: context.request_id
            user_id: context.user_id
            workflow_id: context.workflow_id
            event_type: event_type
      - labels:
          level:
          request_id:
          user_id:
          workflow_id:
          event_type:
      - timestamp:
          format: RFC3339
          source: timestamp

  # Frontend application logs
  - job_name: omnify_frontend
    static_configs:
      - targets:
          - localhost
        labels:
          job: omnify_frontend
          service: web
          environment: ${ENVIRONMENT:-development}
          __path__: /var/log/omnify/frontend/*.log
    pipeline_stages:
      - json:
          expressions:
            timestamp: timestamp
            level: level
            message: message
            sessionId: sessionId
            userId: userId
            url: url
            eventType: eventType
      - labels:
          level:
          sessionId:
          userId:
          eventType:
      - timestamp:
          format: RFC3339
          source: timestamp

  # Workflow execution logs
  - job_name: omnify_workflow
    static_configs:
      - targets:
          - localhost
        labels:
          job: omnify_workflow
          service: workflow
          environment: ${ENVIRONMENT:-development}
          __path__: /var/log/omnify/workflow/*.log
    pipeline_stages:
      - json:
          expressions:
            timestamp: timestamp
            level: level
            message: message
            workflow_id: context.workflow_id
            step_id: step_id
            agent_type: agent_type
            status: step_status
      - labels:
          level:
          workflow_id:
          step_id:
          agent_type:
          status:
      - timestamp:
          format: RFC3339
          source: timestamp

  # System logs (for production monitoring)
  - job_name: system_logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: system
          service: system
          environment: ${ENVIRONMENT:-development}
          __path__: /var/log/omnify/system/*.log
    pipeline_stages:
      - match:
          selector: '{job="system"}'
          stages:
            - regex:
                expression: '^(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}) (?P<level>\w+) (?P<message>.+)$'
            - timestamp:
                format: '2006-01-02 15:04:05'
                source: timestamp
            - labels:
                level:

  # Container logs (for Docker environments)
  - job_name: docker_logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: docker
          service: container
          environment: ${ENVIRONMENT:-development}
          __path__: /var/log/containers/*omnify*.log
    pipeline_stages:
      - docker:
      - json:
          expressions:
            timestamp: timestamp
            level: level
            message: message
      - labels:
          level:
      - timestamp:
          format: RFC3339
          source: timestamp
